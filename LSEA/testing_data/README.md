# LSEA
LSEA (Locus Set Enrichment Analysis) is an LD-aware tool to perform binary gene set enrichment using GWAS data.

Citation: Shikov AE, Skitchenko RK, Predeus AV, and Barbitoff YA. (2020) Phenome-wide functional dissection of pleiotropic effects highlights key molecular pathways for human complex traits. *Sci Rep* www.nature.com/articles/s41598-020-58040-4

**Important notice: This version of the tool has not yet been extensively benchmaked and might be prone to false positives. We are currently revising the algorithm while developing a more flexible and stable version of LSEA that should also become available as a web-interface. We are planning to release the new version on Apr 1, 2020.**

## Getting Started

LSEA is designed to run GSEA using sets of pre-selected significant variants. LSEA takes a tab-separated summary statistics file (one SNP per line) and runs GSEA via simple hypergeometric test. The main advantage of the algorithm is that variants are transformed into a set of independant loci to eliminate false positives from genes in LD. 
<br>The tool uses a precompiled universe of independant loci based on data, obtained from UK Biobank summary statistics (generated by the Neale lab). To generate such universe, summary statistics files for all heritable phenotypes were processed with PLINK and the resulting loci were merged by proximity to obtained the final set of independent signal regions. The universe spans ~2.4 Gbp of the genome. 

### Prerequisites
<ul>
  <li>python (3.7 or higher) </li>
  <li>scipy (1.0.0 or higher)  
  </li>
  <li>pandas (0.17.1 or higher)
  </li>
  <li>numpy (1.14.1 or higher)
  </li> 
  <li>PLINK (1.07 or higher) - http://zzz.bwh.harvard.edu/plink/
  </li>
  <li>SnpEff (4.3T or higher) - http://snpeff.sourceforge.net/
  </li>
</ul>

**Note: LSEA results might be affected by difference in PLINK versions and reference bfile used for clumping. LSEA was tested using PLINK v. 1.9 and 1000 Genomes European reference panel.**

### Installing

To install this tool clone this repository:

```
~$ git clone https://github.com/bioinf/ukb_phewas
```

## Running the tool

LSEA requires a tab-separated file with the following structure: <br> 
<table>
  <tr>
    <td>CHR</td>
    <td>COORDINATE</td>
    <td>RSID</td>
    <td>REF</td>
    <td>ALT</td>
    <td>PVAL</td>
  </tr>
    <tr>
    <td>9</td>
    <td>136058188</td>
    <td>rs12216896</td>
    <td>C</td>
    <td>T</td>
    <td>2.89651e-11</td>
  </tr>
</table>
(header line should be omitted)

To launch the tool you will need to provide this file together with the locations of SnpEff and PLINK, as well as a reference panel file (bfile) to be used during the analysis. Example usage:
```
~$ python3 LSEA.py -af <input tsv-file> -sn <path to SNPeff> -pld <path to plink> -bf <bfile for plink> -p
```

**Do not forget to set the -p flag to run LSEA in the default GSEA mode**

By default, LSEA creates all files in the current working directory. The main results file (`.enrich.tsv`) should have the following structure: 
<table>
  <tr>
    <td>gene_set</td>
    <td>p-value</td>
    <td>q-value</td>
    <td>enrich_description</td>
  </tr>
  <tr>
    <td>BIOCARTA_INTRINSIC_PATHWAY</td>
    <td>2.0446237642438122e-14</td>
    <td>2.2517441515617103e-10</td>
    <td>(17776, 11, 36, 6, 'F11;FGB;FGA;F5;FGG;KLKB1')</td>
  </tr>
</table>
The first column contains the name of the set, the second and the third represent p-value and corrected (FDR-adjusted) q-value of hypergeometric test, the last coloumn includes information about total number of independant loci, number of loci in query, number of loci in gene set, number of loci common for query and gene set and the list of enriched genes.<br> 
Note that the genes list could be larger than the number of common loci, because only indepedant loci are considered during analysis. <br>

By default, LSEA outputs all gene sets that have FDR q-value < 0.1 to increase sensitivity for low-power GWAS. We recommend filtering out gene sets with FDR q-value < 0.001 (or even more strict cutoffs) if the GWAS signal is sufficiently strong.<br>

**Note: SNPs from the HLA locus are excluded from the analisys due to high ambiguity of LD-scores within the HLA region**

## Tool options: 
```
-af <input.tsv> Input file in tsv-format 
-vf <input.vcf> Annotated vcf-file if it is already prepared 
-pl <input.clumped> PlINK  result of clumping (.clumped file) if it is already prepared
--precompiled, -p Use precompiled loci
-sn <path to SnpEff directory> Path to SnpEff
-g <genome> Flag for specifying genome for SnpEff annotation
-pld <path to PlINK directory> Path to PlINK 
-bf <bfile> Bfile for PLINK
```

**Please note that LSEA currently does not include an option to generate a new universe of independent loci and/or add more gene sets to the analysis. This option will come as part of a major update**

## Author

* **Anton Shikov** - *Initial work* - [anton-shikov](https://github.com/anton-shikov)
* **Yury Barbitoff** - *Code review and debugging*


## Contacts

If you have any questions, please do not hesitate to contact the authors at antonshikov96@gmail.com or barbitoff@bioinf.me
